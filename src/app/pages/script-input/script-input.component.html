<div class="min-h-screen bg-[#0f172a] text-white font-['Outfit'] flex items-center justify-center p-4">
    <app-subtitle-editor [isOpen]="subtitleEditorOpen()" [settings]="subtitleSettings()" [musicList]="musicList()"
        [musicSettings]="musicSettings()" (close)="closeSubtitleEditor()"
        (settingsChange)="updateSubtitleSettingsLocal($event)" (saveSettings)="saveSubtitleSettings($event)"
        (musicSettingsChange)="updateMusicSettings($event)" (uploadMusic)="uploadMusic($event)">
    </app-subtitle-editor>

    <div class="w-full max-w-5xl">
        <!-- Header -->
        <div class="mb-8 text-center">
            <h1
                class="text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400 mb-2">
                {{ 'VIDEO_CREATOR' | translate }}
            </h1>
            <p class="text-slate-400 text-lg">{{ 'SUBTITLE' | translate }}</p>
        </div>

        <!-- Main Card -->
        <div class="bg-slate-800/50 backdrop-blur-xl rounded-3xl border border-slate-700/50 p-6 md:p-8 shadow-2xl">
            @if (processingStatus() === 'input') {
            <app-script-form [isSubmitting]="isSubmitting()" [errorMessage]="errorMessage()"
                (formSubmit)="handleScriptSubmit($event)">
            </app-script-form>
            }

            @else if (processingStatus() === 'processing') {
            <div class="flex flex-col items-center justify-center py-12">
                <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-indigo-500 mb-4"></div>
                <p class="text-xl text-slate-300">{{ 'PROCESSING' | translate }}...</p>
                <p class="text-sm text-slate-500 mt-2">{{ 'WAITING_MSG' | translate }}</p>
            </div>
            }

            @else if (processingStatus() === 'preview') {
            <div class="w-full">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-white">{{ 'PREVIEW_TITLE' | translate }}</h2>
                    <button (click)="finalizeVideo()"
                        class="px-6 py-2 bg-gradient-to-r from-indigo-600 to-cyan-600 rounded-lg text-white font-bold hover:scale-105 hover:shadow-lg hover:shadow-indigo-500/30 active:scale-95 transition-all cursor-pointer">
                        {{ 'FINALIZE_VIDEO' | translate }}
                    </button>
                </div>

                <app-preview-player [activeImage]="activeImage()" [previousImage]="previousImage()"
                    [activeSubtitle]="activeSubtitle()" [subtitleSettings]="subtitleSettings()"
                    [showSubtitles]="showSubtitles()" [isPlaying]="playerService.isPlaying()"
                    [currentEffect]="currentEffect()" [aspectRatio]="projectAspectRatio()" (togglePlay)="togglePlay()"
                    (toggleSubtitles)="toggleSubtitles($event)">
                </app-preview-player>

                <app-subtitle-settings-panel [subtitleSettings]="subtitleSettings()"
                    (openSubtitleEditor)="openSubtitleEditor()" (toggleSubtitles)="toggleSubtitles($event)">
                </app-subtitle-settings-panel>

                <app-music-settings-panel [musicSettings]="musicSettings()" [musicList]="musicList()"
                    (musicSettingsChange)="updateMusicSettings($event)" (uploadMusic)="uploadMusic($event)">
                </app-music-settings-panel>

                <app-thumbnail-editor [thumbnailUrl]="thumbnailUrl()" [prompt]="thumbnailPrompt()"
                    [isLoading]="isThumbnailLoading()" [aspectRatio]="projectAspectRatio()"
                    (regenerate)="regenerateThumbnail($event)" (upload)="uploadThumbnail($event)">
                </app-thumbnail-editor>

                <app-segment-list [projectData]="projectData()" [projectId]="projectId()"
                    [subtitleSettings]="subtitleSettings()" [aspectRatio]="projectAspectRatio()"
                    (regenerateImage)="regenerateImage($event.index, $event.prompt)"
                    (uploadImage)="uploadImage($event.index, $event.file)" (updateSubtitle)="updateSubtitle()">
                </app-segment-list>
            </div>
            }

            @else if (processingStatus() === 'generating') {
            <div class="flex flex-col items-center justify-center py-12">
                <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-green-500 mb-4"></div>
                <p class="text-xl text-slate-300">{{ 'GENERATING_FINAL' | translate }}...</p>
                <p class="text-sm text-slate-500 mt-2">{{ 'WAITING_MSG' | translate }}</p>
            </div>
            }

            @else if (processingStatus() === 'failed') {
            <div class="flex flex-col items-center justify-center py-12 text-center p-6">
                <!-- Error Icon -->
                <div class="bg-red-500/10 p-4 rounded-full mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-12 h-12 text-red-500">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                    </svg>
                </div>

                <h2 class="text-2xl font-bold text-white mb-2">{{ 'GENERATION_FAILED' | translate }}</h2>
                <p class="text-slate-400 mb-8 max-w-md">{{ 'FAILED_MSG' | translate }}</p>

                <div class="flex gap-4">
                    <button (click)="resetForm()"
                        class="px-6 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-semibold transition-all shadow-lg active:scale-95">
                        {{ 'NEW_PROJECT' | translate }}
                    </button>
                    <button (click)="handleResume()"
                        class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-white font-semibold transition-all shadow-lg shadow-indigo-500/30 active:scale-95 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>
                        {{ 'RESUME_PROJECT' | translate }}
                    </button>
                </div>
            </div>
            }

            @else if (processingStatus() === 'completed') {
            <app-video-result [videoUrl]="videoUrl()" [aspectRatio]="projectAspectRatio()" (onBack)="resetForm()">
            </app-video-result>
            }
        </div>
    </div>
</div>